"0","# Total Olympic Squad sizes (athlete numbers each Games)"
"0","d <- results_p1 %>% "
"0","  mutate(Year = ifelse(Year%in%c(2021),2020,Year)) %>%"
"0","  filter(Nationality %in% c('AUS','GBR','USA','NZL')) %>%"
"0","  group_by(Nationality, Year) %>%"
"0","  summarise(Athletes = n_distinct(athleteID), .groups='drop')"
"0",""
"0","nswis <- results_p1 %>% filter(nswisResult==1) %>%"
"0","  mutate(Year = ifelse(Year%in%c(2021),2020,Year)) %>%"
"0","  group_by(Year) %>%"
"0","  summarise(Athletes = n_distinct(athleteID),.groups='drop') %>%"
"0","  mutate(Nationality = 'NSWIS')"
"0",""
"0","d <- rbind(d,nswis) %>%"
"0","  mutate(highlight = ifelse(Nationality=='NSWIS','yes','no'))"
"0",""
"0","aus <- mean(d$Athletes[which(d$Year!=2000 & d$Nationality=='AUS')])"
"0","usa <- mean(d$Athletes[which(d$Year!=1996 & d$Nationality=='USA')])"
"0","gbr <- mean(d$Athletes[which(d$Year!=2012 & d$Nationality=='GBR')])"
"0","nsw <- mean(d$Athletes[which(d$Year!=2000 & d$Nationality=='NSWIS')])"
"0",""
"0","d2 <- d %>%"
"0","  mutate("
"0","    Adjusted = ifelse(Year==2000 & Nationality=='AUS', aus, ifelse("
"0","      Year==1996 & Nationality=='USA', usa, ifelse("
"0","        Year==2012 & Nationality=='GBR', gbr, ifelse("
"0","          Year==2000 & Nationality=='NSWIS', nsw, Athletes)))))"
"0",""
"0","d <- cbind(d, d2[,""Adjusted""]) %>%"
"0","  rename(Actual=Athletes) %>%"
"0","  gather(key='Athletes',value='y',-c(Nationality,Year,highlight)) %>%"
"0","  left_join(populations, by=c('Nationality','Year')) %>%"
"0","  mutate(y = 100*y/Population)"
"0",""
"0","d %>%"
"0","  ggplot(aes(x=Year, y=y, group=Nationality,colour=highlight)) +"
"0","  geom_point(aes(shape=Nationality)) +"
"0","  geom_line(aes(linetype=Nationality)) +"
"0","  geom_text(data=d%>%filter(Year==max(d$Year,na.rm=TRUE)),"
"0","            aes(x=Year,y=y,label=Nationality),"
"0","            hjust=-0.5,size=3) +"
"0","  facet_wrap(.~Athletes) +"
"0","  labs(title = 'Squad Size as a proportion (%) of Population', x='', y='% of population') +"
"0","  theme_classic() +"
"0","  theme(legend.position='none') +"
"0","  scale_colour_manual(values=c('yes'='steelblue4','no'='grey40'),guide=FALSE) +"
"0","  scale_y_continuous(expand = c(0,0), limits = c(0,1.2*max(d$y))) + "
"0","  scale_x_continuous(breaks = c(1996,2000,2004,2008,2012,2016,2020), limits = c(1996,2024))"
